<UserControl x:Class="Metra.Desktop.Views.Pages.MijozListPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             Background="Transparent">

    <Grid Background="{StaticResource BackgroundColor}">
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Toolbar -->
            <Border Grid.Row="0" Style="{StaticResource CardBorderWithMarginStyle}" Margin="10 0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Orientation="Horizontal">
                        <Button Style="{StaticResource PrimaryButtonStyle}"
                                Command="{Binding OpenAddDialogCommand}"
                                Margin="0,0,10,0">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Plus" Width="18" Height="18"/>
                                <TextBlock Text="Yangi" Margin="8,0,0,0"/>
                            </StackPanel>
                        </Button>

                        <Button Style="{StaticResource IconButtonStyle}"
                                Command="{Binding RefreshCommand}"
                                ToolTip="Yangilash">
                            <materialDesign:PackIcon Kind="Refresh" Width="20" Height="20"/>
                        </Button>
                    </StackPanel>

                    <Border Grid.Column="1" Style="{StaticResource SearchBoxBorderStyle}" MaxWidth="400">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox Style="{StaticResource SearchTextBoxStyle}"
                                     Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                     materialDesign:HintAssist.Hint="Qidirish..."/>
                            <materialDesign:PackIcon Kind="Magnify" Grid.Column="1"
                                                     Width="20" Height="20" Margin="10,0,5,0"
                                                     VerticalAlignment="Center"/>
                        </Grid>
                    </Border>
                </Grid>
            </Border>

            <!-- DataGrid -->
            <Border Grid.Row="1" Style="{StaticResource CardBorderStyle}">
                <DataGrid ItemsSource="{Binding Mijozlar}"
                          Style="{StaticResource StandardDataGridStyle}"
                          SelectedItem="{Binding SelectedMijoz}">

                    <DataGrid.InputBindings>
                        <MouseBinding MouseAction="LeftDoubleClick" Command="{Binding OpenEditDialogCommand}"/>
                    </DataGrid.InputBindings>

                    <DataGrid.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="Tahrirlash" Command="{Binding OpenEditDialogCommand}">
                                <MenuItem.Icon>
                                    <materialDesign:PackIcon Kind="Pencil"/>
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem Header="O'chirish" Command="{Binding DeleteCommand}">
                                <MenuItem.Icon>
                                    <materialDesign:PackIcon Kind="Delete" Foreground="Red"/>
                                </MenuItem.Icon>
                            </MenuItem>
                        </ContextMenu>
                    </DataGrid.ContextMenu>

                    <DataGrid.Columns>
                        <DataGridTextColumn Header="#" Binding="{Binding Number}" Width="60"
                                            HeaderStyle="{StaticResource CustomDataGridColumnHeaderStyle}"/>
                        <DataGridTextColumn Header="Nomi" Binding="{Binding Name}" Width="*" MinWidth="150"
                                            HeaderStyle="{StaticResource CustomDataGridColumnHeaderStyle}"/>
                        <DataGridTextColumn Header="Telefon" Binding="{Binding Phone}" Width="200"
                                            HeaderStyle="{StaticResource CustomDataGridColumnHeaderStyle}"/>
                        <DataGridTextColumn Header="Passport" Binding="{Binding PassportDisplay}" Width="150"
                                            HeaderStyle="{StaticResource CustomDataGridColumnHeaderStyle}"/>
                        <DataGridTextColumn Header="Filial" Binding="{Binding BranchName}" Width="150"
                                            HeaderStyle="{StaticResource CustomDataGridColumnHeaderStyle}"/>
                        <DataGridTextColumn Header="Sana" Binding="{Binding Date, StringFormat='dd.MM.yyyy'}" Width="150"
                                            HeaderStyle="{StaticResource CustomDataGridColumnHeaderStyle}"/>
                    </DataGrid.Columns>
                </DataGrid>
            </Border>

            <!-- Pagination -->
            <Border Grid.Row="2" Style="{StaticResource CardBorderWithMarginStyle}" Margin="10 0">
                <Grid>
                    <TextBlock VerticalAlignment="Center">
                        <Run Text="Jami:"/>
                        <Run Text="{Binding TotalCount}" FontWeight="Bold"/>
                    </TextBlock>

                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Style="{StaticResource IconButtonStyle}" Command="{Binding PreviousPageCommand}">
                            <materialDesign:PackIcon Kind="ChevronLeft" Width="20" Height="20"/>
                        </Button>

                        <TextBlock VerticalAlignment="Center" Margin="15,0">
                            <Run Text="{Binding CurrentPage}"/>
                            <Run Text="/"/>
                            <Run Text="{Binding TotalPages}"/>
                        </TextBlock>

                        <Button Style="{StaticResource IconButtonStyle}" Command="{Binding NextPageCommand}">
                            <materialDesign:PackIcon Kind="ChevronRight" Width="20" Height="20"/>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>

        <!-- Loading -->
        <Grid Background="#80000000" Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
            <ProgressBar IsIndeterminate="True" Width="100" Height="100"
                         Style="{StaticResource MaterialDesignCircularProgressBar}"/>
        </Grid>
    </Grid>
</UserControl>
